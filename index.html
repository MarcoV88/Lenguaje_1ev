<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Galería de Jugadores</title>
        <link rel="stylesheet" href="styles.css">
    </head>
    <style> /* Estilos básicos utilizados solo para que las imagenes sean parecidas (que no sea unaa imagen enorme y otra pequeña), sacados del anterior profesor de lenguaje de marcas */
    img {
        width: 100px;
        height: auto;   
    }
    </style>
    <body>

    <header>
        <h1>Galería de Jugadores Jóvenes</h1>
        <button id="botonCargarGaleria">Cargar galería</button>
        <input type="text" id="entradaBusqueda" placeholder="Buscar por título">
        <select id="filtroCategoria">
            <option value="">Todas las categorías</option>
        </select>
        <button id="botonRegistro">Ir al registro</button>
    </header>

    <main>
        <section id="galeria"></section>
    </main>

    <dialog id="modal">
        <div id="contenidoModal">
            <button id="cerrarModal">Cerrar</button>
            <h2 id="tituloModal"></h2>
            <img id="imagenModal" alt="">
            <p id="categoriaModal"></p>
            <p id="añoModal"></p>
            <p id="descripcionModal"></p>
        </div>
    </dialog>

    <script>
    const botonCargarGaleria = document.getElementById('botonCargarGaleria');
    const galeria = document.getElementById('galeria');
    const entradaBusqueda = document.getElementById('entradaBusqueda');
    const filtrarCategoria = document.getElementById('filtroCategoria');
    const botonRegistro = document.getElementById('botonRegistro');
    const modal = document.getElementById('modal');
    const contenidoModal = document.getElementById('contenidoModal');
    const tituloModal = document.getElementById('tituloModal');
    const imagenModal = document.getElementById('imagenModal');
    const categoriaModal = document.getElementById('categoriaModal');
    const añoModal = document.getElementById('añoModal');
    const descripcionModal = document.getElementById('descripcionModal');
    const cerrarModal = document.getElementById('cerrarModal');

    let futbolistas = [];

    // Boton para cargar la galería desde el archivo galeria.xml
    botonCargarGaleria.addEventListener("click", () => {
        fetch("galeria.xml")
            .then(response => response.text())
            .then(texto => {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(texto, "text/xml");
                procesarXML(xmlDoc);
            });
    });
    //Con esta funcion proceso el XML 
    function procesarXML(xmlDoc) {
        futbolistas = [];
        const xmlElementos = xmlDoc.getElementsByTagName("elemento");
        galeria.innerHTML = '';
        
        // Recorro los futbolistas del archivo xml mediante un for para extraer sus datos
        for (let i = 0; i < xmlElementos.length; i++) {
            let el = xmlElementos[i];
            
            let titulo = el.getElementsByTagName("titulo")[0].textContent;
            let categoria = el.getElementsByTagName("categoria")[0].textContent;
            let año = el.getElementsByTagName("año")[0].textContent;
            let descripcion = el.getElementsByTagName("descripcion")[0].textContent;
            let imagen = el.getElementsByTagName("imagen")[0].textContent;
            
            // Con este if compruebo que los datos estan bien
            if (!titulo || !categoria || !año || !descripcion || isNaN(año)) continue;
            
            futbolistas.push({titulo, categoria, año, descripcion, imagen});
        }
        
        // Aquí llamaría a las funciones para ver la galería completa
        llenarSelectCategorias();
        mostrarFutbolistas(futbolistas);
        }
    // He encontrado un problema y es que las categorias solo se pueden seleccionar una vez cargada la galería, no se como arreglarlo o si así esta bien
    function llenarSelectCategorias() {
        const catUnica = [...new Set(futbolistas.map(el => el.categoria))]; // Elimina los elementos duplicados
        filtrarCategoria.innerHTML = '<option value="">Todas las categorías</option>';
        
        // Actualiza y rellena el select con todas las categorías (este paso lo busqué por internet además de ayudarme con algún compañero)
        catUnica.forEach(cat => {
            let option = document.createElement("option");
            option.value = cat;
            option.textContent = cat;
            filtrarCategoria.appendChild(option);
        });
    }

    // Aquí muestro los futbolistas de la galería
    function mostrarFutbolistas(lista) {
    galeria.innerHTML = '';
        lista.forEach(elemento => {
            const tituloSolo = document.createElement('div');
            tituloSolo.className = 'nombreJugador'; 
            tituloSolo.textContent = elemento.titulo;

            tituloSolo.addEventListener('click', () => abrirModal(elemento));

            galeria.appendChild(tituloSolo);
        });
    }


    // Aquí filtro la búsqueda por el título, si coincide alguna letra con el jugador lo mostrará
    entradaBusqueda.addEventListener('input', () => {
        const textoBusqueda = entradaBusqueda.value.toLowerCase();
        const filtrados = futbolistas.filter(el => el.titulo.toLowerCase().includes(textoBusqueda));
        mostrarFutbolistas(filtrados);
    });

    // En esta se filtra por la categoría (en este caso, la nacionalidad del jugador)
    filtrarCategoria.addEventListener('change', () => {
        const seleccionado = filtrarCategoria.value;
        const filtrados = seleccionado ? futbolistas.filter(el => el.categoria === seleccionado) : futbolistas;
        mostrarFutbolistas(filtrados);
    });

    // Esta funcion abre el modal, el cual se basa en mostrar la informacion del jugador seleccionado
    function abrirModal(datos) {
    // El modal se rellena con los datos del jugador seleccionado
    tituloModal.textContent = datos.titulo;
    añoModal.textContent = datos.año;
    categoriaModal.textContent = datos.categoria;
    descripcionModal.textContent = datos.descripcion;
    imagenModal.src = datos.imagen;

    // Muestra el modal como mini ventana dentro de la página
    modal.showModal();
}

    // Botón dentro del modal para cerrarlo
    cerrarModal.addEventListener("click", () => {
        modal.close();
    });

    // Botón registro
    botonRegistro.addEventListener('click', () => {
        window.location.href = 'registro.html';
    });
    </script>

    </body>
</html>